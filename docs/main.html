<!DOCTYPE html>

<html>
<head>
  <title>main.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="main.html">
                  main.js
                </a>
              
                
                <a class="source" href="pixi.min.html">
                  pixi.min.js
                </a>
              
                
                <a class="source" href="socket.io-1.4.5.html">
                  socket.io-1.4.5.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>setup</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> playerSide = <span class="hljs-number">0</span>
<span class="hljs-keyword">var</span> gameOverScene;
<span class="hljs-keyword">var</span> player;
<span class="hljs-keyword">var</span> gamestate;
<span class="hljs-keyword">var</span> units = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
<span class="hljs-keyword">var</span> spawn_pos = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
<span class="hljs-keyword">var</span> hud = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
<span class="hljs-keyword">var</span> laneInfo1;
<span class="hljs-keyword">var</span> laneInfo2;
<span class="hljs-keyword">var</span> renderer = PIXI.autoDetectRenderer(<span class="hljs-built_in">window</span>.innerWidth,<span class="hljs-built_in">window</span>.innerHeight, {<span class="hljs-attr">antialias</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">transparent</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">resolution</span>:<span class="hljs-number">1</span>});
<span class="hljs-keyword">var</span> stage = <span class="hljs-keyword">new</span> PIXI.Container();
<span class="hljs-keyword">var</span> laneIndexSelected = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> msg;
<span class="hljs-keyword">var</span> msg2;
<span class="hljs-keyword">var</span> timer = <span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> spawnTime = <span class="hljs-number">500</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Call this to start the game</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span>(<span class="hljs-params">pside</span>)
</span>{
    playerSide = pside;
    <span class="hljs-keyword">var</span> bodyRef = <span class="hljs-built_in">document</span>.body;
    bodyRef.innerHTML = <span class="hljs-string">""</span>;
    <span class="hljs-built_in">document</span>.body.appendChild(renderer.view);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>loading assets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    PIXI.loader
        .add(<span class="hljs-string">"static/assets/main/grass.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/blTile.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/brTile.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/lrTile.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/ltTile.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/lbTile.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/lSplit.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/rSplit.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/tbTile.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/trTile.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/castle1.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/castle2.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/house.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/units/soldier1.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/units/soldier2.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/units/wizard1.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/units/wizard2.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/units/worker1.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/units/worker2.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/details/detail1.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/details/detail2.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/details/detail3.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/details/detail4.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/coin.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/heart.png"</span>)
        .add(<span class="hljs-string">"static/assets/main/arrow.png"</span>)
        .load(setup);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setup</span>(<span class="hljs-params"></span>)
</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Generate Background automatically</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> tile = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-built_in">Math</span>.ceil(<span class="hljs-built_in">window</span>.innerHeight/<span class="hljs-number">64</span>);i++)
    {
        <span class="hljs-keyword">for</span>(j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-built_in">Math</span>.ceil(<span class="hljs-built_in">window</span>.innerWidth/<span class="hljs-number">64</span>);j++)
        {
            tile.push(<span class="hljs-keyword">new</span> PIXI.Sprite( PIXI.loader.resources[<span class="hljs-string">"static/assets/main/grass.png"</span>].texture));
            tile[tile.length - <span class="hljs-number">1</span>].x = j*<span class="hljs-number">64</span>;
            tile[tile.length - <span class="hljs-number">1</span>].y = i*<span class="hljs-number">64</span>;
            tile[tile.length - <span class="hljs-number">1</span>].width = <span class="hljs-number">64</span>;
            tile[tile.length - <span class="hljs-number">1</span>].height = <span class="hljs-number">64</span>;
            stage.addChild(tile[tile.length - <span class="hljs-number">1</span>]);
        }
    }

    <span class="hljs-keyword">var</span> init = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
    <span class="hljs-keyword">if</span> (playerSide == <span class="hljs-number">0</span>)
    {
        init[<span class="hljs-number">0</span>] =  <span class="hljs-built_in">window</span>.innerWidth*<span class="hljs-number">0.2</span>;
    }<span class="hljs-keyword">else</span>{
        init[<span class="hljs-number">0</span>] =  <span class="hljs-built_in">window</span>.innerWidth*<span class="hljs-number">0.8</span>;
    }
    init[<span class="hljs-number">1</span>] = makeCastle(init[<span class="hljs-number">0</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>make castle and assign the initial x</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    makeRoads(init);    
    makeHuts(init);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Create Hud</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hud = <span class="hljs-keyword">new</span> Hud();
    hud.addUnitButton(<span class="hljs-string">"worker"</span>, <span class="hljs-string">"Q"</span>, <span class="hljs-number">50</span>);
    hud.addUnitButton(<span class="hljs-string">"soldier"</span>, <span class="hljs-string">"W"</span>, <span class="hljs-number">25</span>);
    hud.addUnitButton(<span class="hljs-string">"wizard"</span>, <span class="hljs-string">"E"</span>, <span class="hljs-number">250</span>);
    hud.paint();</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create lane information</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    laneInfo0 = <span class="hljs-keyword">new</span> LaneInfo(<span class="hljs-number">0</span>, spawn_pos[<span class="hljs-number">0</span>], spawn_pos[<span class="hljs-number">1</span>]);
    laneInfo0.paint();
    laneInfo1 = <span class="hljs-keyword">new</span> LaneInfo(<span class="hljs-number">1</span>, spawn_pos[<span class="hljs-number">2</span>], spawn_pos[<span class="hljs-number">3</span>]);
    laneInfo1.paint();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>render</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    renderer.render(stage);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Keyboard handling </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> keyQ = keyboard(<span class="hljs-number">81</span>);
    <span class="hljs-keyword">var</span> keyW = keyboard(<span class="hljs-number">87</span>);
    <span class="hljs-keyword">var</span> keyE = keyboard(<span class="hljs-number">69</span>);
    <span class="hljs-keyword">var</span> keyJ = keyboard(<span class="hljs-number">74</span>);
    <span class="hljs-keyword">var</span> keyK = keyboard(<span class="hljs-number">75</span>);
    <span class="hljs-keyword">var</span> keyUp = keyboard(<span class="hljs-number">38</span>);
    <span class="hljs-keyword">var</span> keyDown = keyboard(<span class="hljs-number">40</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>var keyR = keyboard(82);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    keyQ.press = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"train Worker"</span>);
        spawn(<span class="hljs-number">0</span>);
    };
    keyW.press = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"train soldier"</span>);
        spawn(<span class="hljs-number">1</span>);
    };
    keyE.press = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"train wizard"</span>);
        spawn(<span class="hljs-number">2</span>);
    };
    keyJ.press =
    keyDown.press = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (laneIndexSelected == <span class="hljs-number">0</span>)
            laneIndexSelected = <span class="hljs-number">1</span>;
    };
    keyK.press =
    keyUp.press = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (laneIndexSelected == <span class="hljs-number">1</span>)
            laneIndexSelected = <span class="hljs-number">0</span>;
    };
    msg = <span class="hljs-keyword">new</span> PIXI.Text(<span class="hljs-string">"Game"</span>,{<span class="hljs-attr">font</span>:<span class="hljs-string">"100px sans-serif"</span>, <span class="hljs-attr">fill</span>:<span class="hljs-string">"white"</span>});
    msg.x = <span class="hljs-built_in">window</span>.innerWidth - msg.width/<span class="hljs-number">2</span> - <span class="hljs-number">50</span>;
    <span class="hljs-keyword">if</span>(playerSide)
    {
        msg.text = <span class="hljs-string">"Over"</span>;
        msg.x = <span class="hljs-number">50</span> + msg.width/<span class="hljs-number">2</span>;
    }
    msg.anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
    msg.y = <span class="hljs-number">200</span>;
    msg.visible = <span class="hljs-literal">false</span>;
    stage.addChild(msg);
    msg2 = <span class="hljs-keyword">new</span> PIXI.Text(<span class="hljs-string">"You won"</span>,{<span class="hljs-attr">font</span>:<span class="hljs-string">"30px sans-serif"</span>, <span class="hljs-attr">fill</span>:<span class="hljs-string">"white"</span>});
    msg2.anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
    msg2.x = <span class="hljs-built_in">window</span>.innerWidth/<span class="hljs-number">2</span>;
    msg2.y = <span class="hljs-number">300</span>;
    msg2.visible = <span class="hljs-literal">false</span>;
    stage.addChild(msg2);
    gameLoop();
}


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LaneInfo</span> </span>{
    <span class="hljs-keyword">constructor</span>(hutNum, hutX, hutY) {
        <span class="hljs-keyword">this</span>.hutNum = hutNum;

        <span class="hljs-keyword">var</span> iconHeight = <span class="hljs-number">32</span>
        <span class="hljs-keyword">var</span> iconPadding = playerSide ? <span class="hljs-number">40</span> : <span class="hljs-number">-40</span>;
        <span class="hljs-keyword">var</span> iconStartX = hutX + (playerSide ? <span class="hljs-number">84</span>: <span class="hljs-number">0</span>);
        <span class="hljs-keyword">var</span> iconStartY = hutY + <span class="hljs-number">24</span>;

        <span class="hljs-keyword">if</span> (playerSide)
            hutX += <span class="hljs-number">30</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Heart icon</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.heartIcon = makeSprite(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"heart"</span>);
        <span class="hljs-keyword">this</span>.heartIcon.anchor.set(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);
        <span class="hljs-keyword">this</span>.heartIcon.position.set(iconStartX + iconPadding, iconStartY + <span class="hljs-number">48</span>);
        <span class="hljs-keyword">this</span>.heartIcon.height = iconHeight;
        <span class="hljs-keyword">this</span>.heartIcon.width = iconHeight;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Heart value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.heartText = <span class="hljs-keyword">new</span> PIXI.Text(<span class="hljs-string">"0"</span>, {<span class="hljs-attr">font</span>:<span class="hljs-string">"20px sans-serif"</span>, <span class="hljs-attr">fill</span>:<span class="hljs-string">"black"</span>});
        <span class="hljs-keyword">this</span>.heartText.anchor.set(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);
        <span class="hljs-keyword">this</span>.heartText.position.set(<span class="hljs-keyword">this</span>.heartIcon.position.x + <span class="hljs-number">2</span>, <span class="hljs-comment">// slight offset</span>
                <span class="hljs-keyword">this</span>.heartIcon.position.y + <span class="hljs-keyword">this</span>.heartIcon.height);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Worker icon</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.workerIcon = makeSprite(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"units/worker"</span> + (playerSide + <span class="hljs-number">1</span>));
        <span class="hljs-keyword">this</span>.workerIcon.anchor.set(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);
        <span class="hljs-keyword">this</span>.workerIcon.position.set(iconStartX + (<span class="hljs-number">2</span>*iconPadding), iconStartY + <span class="hljs-number">48</span>);
        <span class="hljs-keyword">this</span>.workerIcon.height = iconHeight * <span class="hljs-number">3</span>;<span class="hljs-comment">//Weird whitespace issue with workers</span>
        <span class="hljs-keyword">this</span>.workerIcon.width = iconHeight * <span class="hljs-number">3</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Workers value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.workerText = <span class="hljs-keyword">new</span> PIXI.Text(<span class="hljs-string">"0"</span>, {<span class="hljs-attr">font</span>:<span class="hljs-string">"20px sans-serif"</span>, <span class="hljs-attr">fill</span>:<span class="hljs-string">"black"</span>});
        <span class="hljs-keyword">this</span>.workerText.anchor.set(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);
        <span class="hljs-keyword">this</span>.workerText.position.set(<span class="hljs-keyword">this</span>.workerIcon.position.x + <span class="hljs-number">2</span>, <span class="hljs-comment">// slight offset</span>
                <span class="hljs-keyword">this</span>.workerIcon.position.y + <span class="hljs-keyword">this</span>.heartIcon.height);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Lane selection arrow</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.arrowIcon = makeSprite(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"arrow"</span>);
        <span class="hljs-keyword">this</span>.arrowIcon.anchor.set(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);
        <span class="hljs-keyword">this</span>.arrowIcon.position.set(iconStartX + (<span class="hljs-number">4</span>*iconPadding), iconStartY + <span class="hljs-number">48</span>);
        <span class="hljs-keyword">this</span>.arrowIcon.height = iconHeight * <span class="hljs-number">1.5</span>;
        <span class="hljs-keyword">this</span>.arrowIcon.width = iconHeight * <span class="hljs-number">1.5</span>;
        <span class="hljs-keyword">this</span>.arrowIcon.rotation = playerSide ? <span class="hljs-number">3.14159</span> : <span class="hljs-number">0</span>;
    }

    update() {
        <span class="hljs-keyword">this</span>.workerText.text = player.lanes[<span class="hljs-keyword">this</span>.hutNum].villagers;
        <span class="hljs-keyword">this</span>.heartText.text = player.lanes[<span class="hljs-keyword">this</span>.hutNum].health;
        <span class="hljs-keyword">this</span>.arrowIcon.visible = laneIndexSelected == <span class="hljs-keyword">this</span>.hutNum;
    }

    paint() {
        stage.addChild(<span class="hljs-keyword">this</span>.heartIcon);
        stage.addChild(<span class="hljs-keyword">this</span>.heartText);
        stage.addChild(<span class="hljs-keyword">this</span>.workerIcon);
        stage.addChild(<span class="hljs-keyword">this</span>.workerText);
    }
}


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hud</span> </span>{

    <span class="hljs-keyword">constructor</span>() {
        <span class="hljs-keyword">this</span>.hudPadding = <span class="hljs-number">20</span>;
        <span class="hljs-keyword">this</span>.hudWidth = <span class="hljs-number">168</span>; <span class="hljs-comment">// 128 + padding</span>
        <span class="hljs-keyword">this</span>.hudStartX = playerSide ? <span class="hljs-built_in">window</span>.innerWidth - <span class="hljs-keyword">this</span>.hudWidth : <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Background</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> bg = <span class="hljs-keyword">new</span> PIXI.Graphics();
        bg.beginFill(<span class="hljs-string">"0xdddddd"</span>);
        bg.drawRect(<span class="hljs-keyword">this</span>.hudStartX, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.hudWidth, <span class="hljs-built_in">window</span>.innerHeight);
        bg.endFill();
        bg.alpha = <span class="hljs-number">0.4</span>; <span class="hljs-comment">// slight transparency</span>
        <span class="hljs-keyword">this</span>.background = bg;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Money counter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.moneyCounter = <span class="hljs-keyword">new</span> PIXI.Text(<span class="hljs-string">"0"</span>, {<span class="hljs-attr">font</span>:<span class="hljs-string">"20px sans-serif"</span>, <span class="hljs-attr">fill</span>:<span class="hljs-string">"black"</span>});
        <span class="hljs-keyword">this</span>.coinIcon = makeSprite(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"coin"</span>);
        <span class="hljs-keyword">this</span>.coinIcon.position.set(<span class="hljs-keyword">this</span>.hudStartX + <span class="hljs-keyword">this</span>.hudPadding, <span class="hljs-keyword">this</span>.hudPadding);
        <span class="hljs-keyword">this</span>.coinIcon.width = <span class="hljs-keyword">this</span>.moneyCounter.height;
        <span class="hljs-keyword">this</span>.coinIcon.height = <span class="hljs-keyword">this</span>.moneyCounter.height;
        <span class="hljs-keyword">this</span>.moneyCounter.position.set(<span class="hljs-keyword">this</span>.coinIcon.position.x + <span class="hljs-keyword">this</span>.coinIcon.width + <span class="hljs-number">10</span>,
                <span class="hljs-keyword">this</span>.coinIcon.position.y);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Buttons</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.buttons = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
    }

    paint() {
        [<span class="hljs-keyword">this</span>.background, <span class="hljs-keyword">this</span>.coinIcon, <span class="hljs-keyword">this</span>.moneyCounter].forEach(
                <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>)</span>{stage.addChild(item)}
                );
        <span class="hljs-keyword">this</span>.buttons.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">button</span>) </span>{
            stage.addChild(button.btn);
            stage.addChild(button.sprite);
            stage.addChild(button.text);
            stage.addChild(button.price);
            stage.addChild(button.coin);
        });
    }

    update() {
        <span class="hljs-keyword">this</span>.moneyCounter.text = <span class="hljs-built_in">Math</span>.floor(player.money);
    }

    addUnitButton(unitName, shortcutKey, unitPrice) {

        <span class="hljs-keyword">var</span> buttonWidth = <span class="hljs-number">128</span>;
        <span class="hljs-keyword">var</span> buttonHeight = <span class="hljs-number">128</span>;
        <span class="hljs-keyword">var</span> buttonPadding = <span class="hljs-number">10</span>;

        <span class="hljs-keyword">var</span> buttonStartX = <span class="hljs-keyword">this</span>.hudStartX + <span class="hljs-keyword">this</span>.hudPadding;
        <span class="hljs-keyword">var</span> buttonStartY = <span class="hljs-keyword">this</span>.moneyCounter.position.y + <span class="hljs-keyword">this</span>.moneyCounter.height + <span class="hljs-keyword">this</span>.hudPadding + (<span class="hljs-keyword">this</span>.buttons.length * (buttonHeight + <span class="hljs-keyword">this</span>.hudPadding));</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Create button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> button = <span class="hljs-keyword">new</span> PIXI.Graphics();
        button.beginFill(<span class="hljs-string">"0xdddddd"</span>);
        button.drawRect(buttonStartX, buttonStartY,<span class="hljs-number">128</span>,<span class="hljs-number">128</span>);
        button.endFill();
        button.alpha = <span class="hljs-number">0.35</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Create sprite</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> buttonSprite = makeSprite(buttonStartX, buttonStartY<span class="hljs-number">-5</span>, <span class="hljs-string">'units/'</span>+ unitName + (playerSide +<span class="hljs-number">1</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Create shorcut key text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> shortcutText = <span class="hljs-keyword">new</span> PIXI.Text(shortcutKey, {<span class="hljs-attr">font</span>:<span class="hljs-string">"20px sans-serif"</span>, <span class="hljs-attr">fill</span>:<span class="hljs-string">"grey"</span>});
        shortcutText.position.set(buttonStartX+buttonPadding, buttonStartY+buttonPadding);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Create price</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> priceText = <span class="hljs-keyword">new</span> PIXI.Text(unitPrice, {<span class="hljs-attr">font</span>:<span class="hljs-string">"20px sans-serif"</span>, <span class="hljs-attr">fill</span>:<span class="hljs-string">"grey"</span>});
        <span class="hljs-keyword">var</span> coinIcon = makeSprite(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"coin"</span>);
        coinIcon.position.set(buttonStartX+buttonPadding,
                buttonStartY+buttonHeight-buttonPadding-priceText.height);
        coinIcon.width = priceText.height; <span class="hljs-comment">// Slightly smaller</span>
        coinIcon.height = priceText.height;
        priceText.position.set(coinIcon.position.x+coinIcon.width+<span class="hljs-number">5</span>, coinIcon.position.y);

        <span class="hljs-keyword">this</span>.buttons.push({<span class="hljs-attr">btn</span>: button, <span class="hljs-attr">sprite</span>: buttonSprite, <span class="hljs-attr">text</span>: shortcutText, <span class="hljs-attr">coin</span>: coinIcon, <span class="hljs-attr">price</span>: priceText});
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeSprite</span>(<span class="hljs-params">x, y, sprite</span>)
</span>{
    <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">new</span> PIXI.Sprite(PIXI.loader.resources[<span class="hljs-string">"static/assets/main/"</span>+sprite+<span class="hljs-string">".png"</span>].texture);
    tmp.x = x;
    tmp.y = y;
    stage.addChild(tmp);
    <span class="hljs-keyword">return</span> tmp;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeHuts</span>(<span class="hljs-params">init</span>)
</span>{
    <span class="hljs-keyword">var</span> huts = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
    <span class="hljs-keyword">if</span>(playerSide == <span class="hljs-number">0</span>)
    {
        huts.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">256</span>+<span class="hljs-number">32</span>,init[<span class="hljs-number">1</span>]<span class="hljs-number">-256</span>+<span class="hljs-number">32</span>,<span class="hljs-string">"house"</span>));
        spawn_pos[<span class="hljs-number">0</span>] = huts[<span class="hljs-number">0</span>].x; 
        spawn_pos[<span class="hljs-number">1</span>] = huts[<span class="hljs-number">0</span>].y - <span class="hljs-number">43</span>; 
        huts.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">256</span>+<span class="hljs-number">32</span>,init[<span class="hljs-number">1</span>]+<span class="hljs-number">256</span>+<span class="hljs-number">32</span>,<span class="hljs-string">"house"</span>));
        spawn_pos[<span class="hljs-number">2</span>] = huts[<span class="hljs-number">1</span>].x; 
        spawn_pos[<span class="hljs-number">3</span>] = huts[<span class="hljs-number">1</span>].y - <span class="hljs-number">43</span>; 
    }<span class="hljs-keyword">else</span>{
        huts.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-384</span>+<span class="hljs-number">32</span>,init[<span class="hljs-number">1</span>]<span class="hljs-number">-256</span>+<span class="hljs-number">32</span>,<span class="hljs-string">"house"</span>));
        spawn_pos[<span class="hljs-number">0</span>] = huts[<span class="hljs-number">0</span>].x - <span class="hljs-number">30</span>; 
        spawn_pos[<span class="hljs-number">1</span>] = huts[<span class="hljs-number">0</span>].y - <span class="hljs-number">43</span>; 
        huts.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-384</span>+<span class="hljs-number">32</span>,init[<span class="hljs-number">1</span>]+<span class="hljs-number">256</span>+<span class="hljs-number">32</span>,<span class="hljs-string">"house"</span>));
        spawn_pos[<span class="hljs-number">2</span>] = huts[<span class="hljs-number">1</span>].x - <span class="hljs-number">30</span>; 
        spawn_pos[<span class="hljs-number">3</span>] = huts[<span class="hljs-number">1</span>].y - <span class="hljs-number">43</span>; 
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeRoads</span>(<span class="hljs-params">init</span>)
</span>{
    <span class="hljs-keyword">var</span> roads = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>();
    <span class="hljs-keyword">if</span>(playerSide == <span class="hljs-number">0</span>)
    {
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">128</span>,init[<span class="hljs-number">1</span>],<span class="hljs-string">"lrTile"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">256</span>,init[<span class="hljs-number">1</span>],<span class="hljs-string">"lSplit"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">256</span>,init[<span class="hljs-number">1</span>]+<span class="hljs-number">128</span>,<span class="hljs-string">"tbTile"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">256</span>,init[<span class="hljs-number">1</span>]<span class="hljs-number">-128</span>,<span class="hljs-string">"tbTile"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">256</span>,init[<span class="hljs-number">1</span>]<span class="hljs-number">-256</span>,<span class="hljs-string">"brTile"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">256</span>,init[<span class="hljs-number">1</span>]+<span class="hljs-number">256</span>,<span class="hljs-string">"trTile"</span>));
        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-built_in">Math</span>.ceil((<span class="hljs-built_in">window</span>.innerWidth - init[<span class="hljs-number">0</span>]+<span class="hljs-number">384</span>)/<span class="hljs-number">128</span>);i++)
        {
            roads.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">384</span>+(i*<span class="hljs-number">128</span>),init[<span class="hljs-number">1</span>]+<span class="hljs-number">256</span>,<span class="hljs-string">"lrTile"</span>));
            roads.push(makeSprite(init[<span class="hljs-number">0</span>]+<span class="hljs-number">384</span>+(i*<span class="hljs-number">128</span>),init[<span class="hljs-number">1</span>]<span class="hljs-number">-256</span>,<span class="hljs-string">"lrTile"</span>));
        }
    }<span class="hljs-keyword">else</span>{
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-256</span>,init[<span class="hljs-number">1</span>],<span class="hljs-string">"lrTile"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-384</span>,init[<span class="hljs-number">1</span>],<span class="hljs-string">"rSplit"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-384</span>,init[<span class="hljs-number">1</span>]<span class="hljs-number">-128</span>,<span class="hljs-string">"tbTile"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-384</span>,init[<span class="hljs-number">1</span>]+<span class="hljs-number">128</span>,<span class="hljs-string">"tbTile"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-384</span>,init[<span class="hljs-number">1</span>]+<span class="hljs-number">256</span>,<span class="hljs-string">"ltTile"</span>));
        roads.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-384</span>,init[<span class="hljs-number">1</span>]<span class="hljs-number">-256</span>,<span class="hljs-string">"lbTile"</span>));
        <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-built_in">Math</span>.ceil((<span class="hljs-built_in">window</span>.innerWidth - init[<span class="hljs-number">0</span>]+<span class="hljs-number">800</span>)/<span class="hljs-number">128</span>);i++)
        {
            roads.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-512</span>-(i*<span class="hljs-number">128</span>),init[<span class="hljs-number">1</span>]+<span class="hljs-number">256</span>,<span class="hljs-string">"lrTile"</span>));
            roads.push(makeSprite(init[<span class="hljs-number">0</span>]<span class="hljs-number">-512</span>-(i*<span class="hljs-number">128</span>),init[<span class="hljs-number">1</span>]<span class="hljs-number">-256</span>,<span class="hljs-string">"lrTile"</span>));
        }
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeCastle</span>(<span class="hljs-params">xInit</span>)
</span>{
    <span class="hljs-keyword">var</span> center = <span class="hljs-built_in">window</span>.innerHeight/<span class="hljs-number">2</span>;
    <span class="hljs-keyword">var</span> castle = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">2</span>);
    castle[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> PIXI.Sprite(PIXI.loader.resources[<span class="hljs-string">"static/assets/main/castle1.png"</span>].texture);
    castle[<span class="hljs-number">0</span>].y = center + (castle[<span class="hljs-number">0</span>].height/<span class="hljs-number">2</span>) - <span class="hljs-number">64</span>;
    <span class="hljs-keyword">if</span>(playerSide ==<span class="hljs-number">0</span>)
    {
        castle[<span class="hljs-number">0</span>].x = xInit + <span class="hljs-number">5</span>; 
    }<span class="hljs-keyword">else</span>{
        castle[<span class="hljs-number">0</span>].x = xInit - <span class="hljs-number">128</span> <span class="hljs-number">-5</span>; 
    }
    castle[<span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span> PIXI.Sprite(PIXI.loader.resources[<span class="hljs-string">"static/assets/main/castle2.png"</span>].texture);
    castle[<span class="hljs-number">1</span>].y = castle[<span class="hljs-number">0</span>].y - castle[<span class="hljs-number">1</span>].height; 
    <span class="hljs-keyword">if</span>(playerSide == <span class="hljs-number">0</span>)
    {
        castle[<span class="hljs-number">1</span>].x = xInit + <span class="hljs-number">5</span> ;
    }<span class="hljs-keyword">else</span>{
        castle[<span class="hljs-number">1</span>].x = xInit - <span class="hljs-number">128</span> <span class="hljs-number">-5</span>;
    }
    <span class="hljs-keyword">var</span> name = <span class="hljs-keyword">new</span> PIXI.Text(player.name,{<span class="hljs-attr">font</span>:<span class="hljs-string">"20px sans-serif"</span>, <span class="hljs-attr">fill</span>:<span class="hljs-string">"black"</span>});
    <span class="hljs-keyword">if</span>(player.name == <span class="hljs-string">""</span>)
        name.text = <span class="hljs-string">"The Biene"</span>;
    name.anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
    name.x = castle[<span class="hljs-number">1</span>].x + <span class="hljs-number">64</span>;
    name.y = castle[<span class="hljs-number">1</span>].y + <span class="hljs-number">32</span>;
    
    stage.addChild(name);
    stage.addChild(castle[<span class="hljs-number">0</span>]);
    stage.addChild(castle[<span class="hljs-number">1</span>]);
    <span class="hljs-keyword">return</span> castle[<span class="hljs-number">0</span>].y - <span class="hljs-number">30</span>;   
}</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>GAME LOOP GOODNESS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gameLoop</span>(<span class="hljs-params"></span>)
</span>{
    requestAnimationFrame(gameLoop);
    renderer.render(stage);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>destroying units offscreen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    units.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unit</span>) </span>{ <span class="hljs-keyword">if</span>(unit.x &gt; innerWidth +<span class="hljs-number">128</span>) 
        { 
            units.splice(units.indexOf(unit),<span class="hljs-number">1</span>);
            stage.removeChild(unit);
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"unit destroyed in order to free memory"</span>);
        } });</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>update Money counter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hud.update();
    laneInfo0.update();
    laneInfo1.update();

    draw();

}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">spawn</span>(<span class="hljs-params">unit</span>)
</span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Date</span>.now() &gt; timer + spawnTime) 
    {
        <span class="hljs-keyword">var</span> spawns = [<span class="hljs-string">'worker'</span>, <span class="hljs-string">'soldier'</span>, <span class="hljs-string">'wizard'</span>];
        socket.emit(<span class="hljs-string">'spawn'</span>, { <span class="hljs-attr">lane</span>:laneIndexSelected, <span class="hljs-attr">type</span>:spawns[unit]});
        timer = <span class="hljs-built_in">Date</span>.now();
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Timer still up"</span>)
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span>(<span class="hljs-params"></span>)
</span>{
    <span class="hljs-keyword">if</span>(playerSide == <span class="hljs-number">0</span>)
    {
        <span class="hljs-keyword">var</span> lanes = gamestate.playerLeft.lanes;
        <span class="hljs-keyword">var</span> opLanes = gamestate.playerRight.lanes;
        <span class="hljs-keyword">var</span> oPlayer = <span class="hljs-number">2</span>;
    }<span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">var</span> lanes = gamestate.playerRight.lanes;
        <span class="hljs-keyword">var</span> opLanes = gamestate.playerLeft.lanes;
        <span class="hljs-keyword">var</span> oPlayer = <span class="hljs-number">1</span>;
    }
    units.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unit</span>) </span>{
            units.splice(units.indexOf(unit),<span class="hljs-number">1</span>);
            stage.removeChild(unit);
            })
    lanes[<span class="hljs-number">0</span>].units.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unit</span>)
            </span>{
                <span class="hljs-keyword">var</span> ends = [renderer.width,spawn_pos[<span class="hljs-number">0</span>]];
                <span class="hljs-keyword">if</span>(playerSide == <span class="hljs-number">0</span>)
                {
                    <span class="hljs-keyword">var</span> spawn = [spawn_pos[<span class="hljs-number">0</span>]+<span class="hljs-number">64</span>,renderer.width];
                    <span class="hljs-keyword">if</span>(unit.progress &lt; <span class="hljs-number">50</span>)
                    {
                        units.push(makeSprite(spawn[<span class="hljs-number">0</span>] + (ends[<span class="hljs-number">0</span>]-spawn[<span class="hljs-number">0</span>])*(unit.progress/<span class="hljs-number">50</span>),spawn_pos[<span class="hljs-number">1</span>]+<span class="hljs-number">64</span>,<span class="hljs-string">"units/"</span>+ unit.type +(playerSide+<span class="hljs-number">1</span>)));
                        units[units.length<span class="hljs-number">-1</span>].anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
                    }
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">var</span> spawn = [spawn_pos[<span class="hljs-number">0</span>],renderer.width];
                    <span class="hljs-keyword">if</span>(unit.progress &lt;<span class="hljs-number">50</span>)
                    {
                        units.push(makeSprite(spawn[<span class="hljs-number">0</span>]-(spawn[<span class="hljs-number">0</span>])*(unit.progress / <span class="hljs-number">50</span>),spawn_pos[<span class="hljs-number">1</span>]+<span class="hljs-number">64</span>,<span class="hljs-string">"units/"</span> + unit.type + (playerSide+<span class="hljs-number">1</span>)));
                        units[units.length<span class="hljs-number">-1</span>].anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
                    }
                }
            });
    opLanes[<span class="hljs-number">0</span>].units.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unit</span>)
            </span>{
                <span class="hljs-keyword">var</span> spawn = [spawn_pos[<span class="hljs-number">0</span>]+<span class="hljs-number">128</span>,renderer.width];
                <span class="hljs-keyword">var</span> ends = [renderer.width,spawn_pos[<span class="hljs-number">0</span>]];
                <span class="hljs-keyword">if</span>(playerSide == <span class="hljs-number">0</span>)
                {
                    <span class="hljs-keyword">if</span>(unit.progress &gt; <span class="hljs-number">50</span>)
                    {
                        units.push(makeSprite(spawn[<span class="hljs-number">1</span>] - (spawn[<span class="hljs-number">1</span>]-ends[<span class="hljs-number">1</span>])*((unit.progress - <span class="hljs-number">50</span>)/<span class="hljs-number">50</span>),spawn_pos[<span class="hljs-number">1</span>]+<span class="hljs-number">64</span>,<span class="hljs-string">"units/"</span>+ unit.type +oPlayer));
                        units[units.length<span class="hljs-number">-1</span>].anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
                    }
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">if</span>(unit.progress &gt; <span class="hljs-number">50</span>)
                    {
                        units.push(makeSprite((ends[<span class="hljs-number">1</span>])*((unit.progress<span class="hljs-number">-50</span>)/<span class="hljs-number">50</span>),spawn_pos[<span class="hljs-number">1</span>]+<span class="hljs-number">64</span>,<span class="hljs-string">"units/"</span>+ unit.type +oPlayer));
                        units[units.length<span class="hljs-number">-1</span>].anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
                    }
                }
            })
    lanes[<span class="hljs-number">1</span>].units.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unit</span>)
            </span>{
                <span class="hljs-keyword">var</span> ends = [renderer.width,spawn_pos[<span class="hljs-number">0</span>]];
                <span class="hljs-keyword">if</span>(playerSide == <span class="hljs-number">0</span>)
                {
                    <span class="hljs-keyword">var</span> spawn = [spawn_pos[<span class="hljs-number">0</span>]+<span class="hljs-number">64</span>,renderer.width];
                    <span class="hljs-keyword">if</span>(unit.progress &lt; <span class="hljs-number">50</span>)
                    {
                        units.push(makeSprite(spawn[<span class="hljs-number">0</span>] + (ends[<span class="hljs-number">0</span>]-spawn[<span class="hljs-number">0</span>])*(unit.progress/<span class="hljs-number">50</span>),spawn_pos[<span class="hljs-number">3</span>]+<span class="hljs-number">64</span>,<span class="hljs-string">"units/"</span>+ unit.type +(playerSide+<span class="hljs-number">1</span>)));
                        units[units.length<span class="hljs-number">-1</span>].anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
                    }
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">var</span> spawn = [spawn_pos[<span class="hljs-number">0</span>],renderer.width];
                    <span class="hljs-keyword">if</span>(unit.progress &lt;<span class="hljs-number">50</span>)
                    {
                        units.push(makeSprite(spawn[<span class="hljs-number">0</span>]-(spawn[<span class="hljs-number">0</span>])*(unit.progress / <span class="hljs-number">50</span>),spawn_pos[<span class="hljs-number">3</span>]+<span class="hljs-number">64</span>,<span class="hljs-string">"units/"</span> + unit.type + (playerSide+<span class="hljs-number">1</span>)));
                        units[units.length<span class="hljs-number">-1</span>].anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
                    }
                }
            });
    opLanes[<span class="hljs-number">1</span>].units.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">unit</span>)
            </span>{
                <span class="hljs-keyword">var</span> spawn = [spawn_pos[<span class="hljs-number">0</span>]+<span class="hljs-number">128</span>,renderer.width];
                <span class="hljs-keyword">var</span> ends = [renderer.width,spawn_pos[<span class="hljs-number">0</span>]];
                <span class="hljs-keyword">if</span>(playerSide == <span class="hljs-number">0</span>)
                {
                    <span class="hljs-keyword">if</span>(unit.progress &gt; <span class="hljs-number">50</span>)
                    {
                        units.push(makeSprite(spawn[<span class="hljs-number">1</span>] - (spawn[<span class="hljs-number">1</span>]-ends[<span class="hljs-number">1</span>])*((unit.progress - <span class="hljs-number">50</span>)/<span class="hljs-number">50</span>),spawn_pos[<span class="hljs-number">3</span>]+<span class="hljs-number">64</span>,<span class="hljs-string">"units/"</span>+ unit.type +oPlayer));
                        units[units.length<span class="hljs-number">-1</span>].anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
                    }
                }<span class="hljs-keyword">else</span>{
                    <span class="hljs-keyword">if</span>(unit.progress &gt; <span class="hljs-number">50</span>)
                    {
                        units.push(makeSprite((ends[<span class="hljs-number">1</span>])*((unit.progress<span class="hljs-number">-50</span>)/<span class="hljs-number">50</span>),spawn_pos[<span class="hljs-number">3</span>]+<span class="hljs-number">64</span>,<span class="hljs-string">"units/"</span>+ unit.type +oPlayer));
                        units[units.length<span class="hljs-number">-1</span>].anchor.set(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.5</span>);
                    }
                }
            })

}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">keyboard</span>(<span class="hljs-params">keyCode</span>) </span>{
  <span class="hljs-keyword">var</span> key = {};
  key.code = keyCode;
  key.isDown = <span class="hljs-literal">false</span>;
  key.isUp = <span class="hljs-literal">true</span>;
  key.press = <span class="hljs-literal">undefined</span>;
  key.release = <span class="hljs-literal">undefined</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>The <code>downHandler</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  key.downHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.keyCode === key.code) {
      <span class="hljs-keyword">if</span> (key.isUp &amp;&amp; key.press) key.press();
      key.isDown = <span class="hljs-literal">true</span>;
      key.isUp = <span class="hljs-literal">false</span>;
    }
    event.preventDefault();
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>The <code>upHandler</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  key.upHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    <span class="hljs-keyword">if</span> (event.keyCode === key.code) {
      <span class="hljs-keyword">if</span> (key.isDown &amp;&amp; key.release) key.release();
      key.isDown = <span class="hljs-literal">false</span>;
      key.isUp = <span class="hljs-literal">true</span>;
    }
    event.preventDefault();
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Attach event listeners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">window</span>.addEventListener(
    <span class="hljs-string">"keydown"</span>, key.downHandler.bind(key), <span class="hljs-literal">false</span>
  );
  <span class="hljs-built_in">window</span>.addEventListener(
    <span class="hljs-string">"keyup"</span>, key.upHandler.bind(key), <span class="hljs-literal">false</span>
  );
  <span class="hljs-keyword">return</span> key;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gameOver</span>(<span class="hljs-params">winner</span>)
</span>{
    msg.visible = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span>(winner == playerSide)
        msg2.visible = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">document</span>.body.className = <span class="hljs-string">'gray'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>function resizeStage()
{
    buttons.forEach(function(bt){bt.destroy();});
    var init = new Array();
    if (player == 0)
    {
        init[0] =  window.innerWidth<em>0.2;
    }else{
        init[0] =  window.innerWidth</em>0.8;
    }
    init[1] = makeCastle(init[0]);
    //make castle and assign the initial x
    makeRoads(init);<br>    makeHuts(init);
    // (); 
    // makeButtons();</p>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <pre><code>buttons.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>)</span>{stage.addChild(item)});
</code></pre><p>}</p>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Socket.io stuff</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>socket.on(<span class="hljs-string">'gamestate'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)
        </span>{
            gamestate = data.gamestate;
            player =  playerSide ? data.gamestate.playerRight : data.gamestate.playerLeft;
        });
socket.on(<span class="hljs-string">'gameend'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)
        </span>{
            gameOver(data.winner);
        });</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
